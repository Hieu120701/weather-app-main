<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>
<body id="body" class="bg-gradient-to-b from-blue-900 to-indigo-900 text-white min-h-screen flex">
  <!-- Sidebar -->
  <aside class="sidebar flex flex-col items-center py-6 bg-black bg-opacity-40 w-16 min-h-screen">
    <img src="images/weather.png" class="w-8 h-8 mb-8" alt="Weather">
    <img src="images/home.png" class="w-6 h-6 mb-6 opacity-60" alt="Home">
    <img src="images/star.png" class="w-6 h-6 mb-6 opacity-60" alt="Star">
    <img src="images/settings.png" class="w-6 h-6 mb-6 opacity-60" alt="Settings">
  </aside>

  <!-- Main Content -->
  <div class="flex-1 max-w-7xl mx-auto px-4 py-6">
    <!-- Topbar -->
    <div class="flex justify-between items-center py-4">
      <div class="flex space-x-2">
        <button class="bg-white bg-opacity-10 rounded-full px-4 py-1 flex items-center space-x-2">
          <span>æ±äº¬éƒ½</span><span class="text-yellow-400">â—</span><span>24â„ƒ</span>
        </button>
        <button class="bg-white bg-opacity-10 rounded-full px-4 py-1 flex items-center space-x-2">
          <span>å¤§é˜ªå¸‚</span><span>24â„ƒ</span>
        </button>
        <!-- ThÃªm cÃ¡c thÃ nh phá»‘ khÃ¡c -->
      </div>
      <div class="flex items-center space-x-2">
        <input type="text" id="search-input" class="input text-black p-2 rounded" placeholder="å ´æ‰€ã‚’æ¤œç´¢" spellcheck="false">
        <button id="search-btn" class="button bg-blue-500 text-white px-3 py-2 rounded"><img src="images/search.png" class="inline w-5 h-5" alt="æ¤œç´¢"></button>
        <button id="toggle-mode" class="bg-white text-black px-3 py-2 rounded">ğŸŒ—</button>
      </div>
    </div>

    <!-- 3 card ngang -->
    <div class="main-cards-row grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
      <!-- Card: Thá»i tiáº¿t hiá»‡n táº¡i -->
      <div id="current-weather" class="main-card flex flex-col items-center justify-center">
        <div>
          <h1 class="text-2xl font-bold city" id="location-name">éƒ½å¸‚å</h1>
          <p class="text-sm" id="weather-time">æ™‚åˆ»</p>
        </div>
        <img src="images/rain.png" class="weather-icon-small" id="weather-img" alt="å¤©æ°—ã‚¢ã‚¤ã‚³ãƒ³">
        <div class="text-3xl font-bold temp mt-2" id="temperature">--â„ƒ</div>
        <div class="text-sm" id="description">å¤©æ°—èª¬æ˜</div>
        <div class="details flex justify-center gap-8 mt-4">
          <div class="col flex items-center space-x-2">
            <img src="images/humidity.png" class="icon-small" alt="æ¹¿åº¦">
            <div>
              <p class="humidity font-bold" id="humidity">--%</p>
              <p>æ¹¿åº¦</p>
            </div>
          </div>
          <div class="col flex items-center space-x-2">
            <img src="images/wind.png" class="icon-small" alt="é¢¨é€Ÿ">
            <div>
              <p class="wind font-bold" id="wind">--km/h</p>
              <p>é¢¨é€Ÿ</p>
            </div>
          </div>
        </div>
      </div>
      <!-- Card: Báº£n Ä‘á»“ -->
      <div class="main-card flex flex-col items-center justify-center">
        <div class="text-xs text-center mt-2 flex flex-col items-center gap-2" style="width: 100%;">
          <span>ãã®ä»–ã®å ´æ‰€ã‚’è¡¨ç¤º</span>
          <button id="locate-btn" class="locate-btn flex items-center gap-1 mt-1">
            <img src="images/location.png" alt="Äá»‹nh vá»‹" style="width:18px;height:18px;">
            <span>ç¾åœ¨åœ°ã§æ¤œç´¢</span>
          </button>
          <!-- Windy map nhÃºng, xem thá»i tiáº¿t Ä‘á»™ng -->
          <a href="https://www.windy.com/?35.6895,139.6917,5" target="_blank" title="Xem thá»i tiáº¿t Ä‘á»™ng trÃªn Windy"
             style="display:block;border-radius:18px;overflow:hidden;margin-top:16px;width:100%;">
            <iframe
              width="300%"
              height="4440"
              src="https://embed.windy.com/embed2.html?lat=36.2048&lon=138.2529&detailLat=36.2048&detailLon=138.2529&width=600&height=260&zoom=5&level=surface&overlay=wind&product=ecmwf&menu=&message=true&marker=&calendar=now&pressure=&type=map&location=coordinates&detail=&metricWind=default&metricTemp=default&radarRange=-1"
              frameborder="0"
              style="border:0; border-radius:18px; display:block; width:100%; min-width:240px; max-width:100%;"
              allowfullscreen>
            </iframe>
          </a>
        </div>
      </div>
      <!-- Card: Biá»ƒu Ä‘á»“ máº·t trá»i -->
      <div class="main-card flex flex-col items-center justify-center" id="sun-info">
        <img src="images/sun-graph.png" class="icon-sun" alt="Sun Graph">
        <div class="flex flex-col items-center">
          <div>æ—¥ã®å‡º: <span class="font-bold" id="sunrise">--:--</span></div>
          <div>æ—¥ã®å…¥ã‚Š: <span class="font-bold" id="sunset">--:--</span></div>
          <div>é•·ã•: <span class="font-bold" id="day-length">--æ™‚é–“</span></div>
        </div>
      </div>
    </div>

    <!-- Error Message -->
    <div id="error-message" class="mb-4 text-red-500 font-bold text-center"></div>

    <!-- Dá»± bÃ¡o theo giá» -->
    <div class="hourly-section mt-2">
      <h2 class="text-xl font-bold mb-2">1æ™‚é–“ã”ã¨ã®äºˆå ±</h2>
      <div class="flex space-x-2 mb-2 justify-center">
        <button class="tab-btn active" data-type="temp">æ¦‚è¦</button>
        <button class="tab-btn" data-type="rain">é™æ°´é‡</button>
        <button class="tab-btn" data-type="wind">é¢¨</button>
        <button class="tab-btn" data-type="humidity">æ¹¿åº¦</button>
      </div>
      <div id="hourly-forecast"></div>
    </div>

    <!-- Weekly Forecast -->
    <div class="mt-8">
      <h2 class="text-xl font-bold mb-2">é€±é–“äºˆå ±</h2>
      <div id="daily-forecast"></div>
    </div>
    <p class="mt-8 text-center text-xs text-white/70">Made by VINMO.DEV</p>
  </div>
  <script>
    const apikey = "70a0b2cb36a5ef013414269041b73822";
    const apiUrl = "https://api.openweathermap.org/data/2.5/weather?units=metric&q=";
    const forecastApiUrl = "https://api.openweathermap.org/data/2.5/forecast?units=metric&q=";

    const searchInput = document.getElementById("search-input");
    const searchBtn = document.getElementById("search-btn");
    const weatherImg = document.getElementById("weather-img");

    let currentHourlyType = "temp";
    let lastForecastData = null;

    function renderHourly(forecastData, type = "temp") {
      const iconMap = {
        "Clouds": "clouds.png",
        "Rain": "rain.png",
        "Clear": "clear.png",
        "Mist": "mist.png",
        "Drizzle": "drizzle.png",
        "Snow": "snow.png"
      };
      document.getElementById("hourly-forecast").innerHTML = forecastData.list.slice(0, 8).map(f => {
        let value = "";
        let unit = "";
        if (type === "temp") {
          value = Math.round(f.main.temp);
          unit = "Â°";
        } else if (type === "rain") {
          value = f.rain && f.rain["3h"] ? f.rain["3h"] : 0;
          unit = "mm";
        } else if (type === "wind") {
          value = Math.round(f.wind.speed);
          unit = "m/s";
        } else if (type === "humidity") {
          value = f.main.humidity;
          unit = "%";
        }
        return `
          <div class="hourly-card">
            <div>${new Date(f.dt * 1000).getHours()}:00</div>
            <img src="images/${iconMap[f.weather[0].main] || "clouds.png"}" class="hourly-icon" alt="">
            <div>${value}${unit}</div>
          </div>
        `;
      }).join('');
    }

    async function checkWeather(city) {
      try {
        const response = await fetch(apiUrl + encodeURIComponent(city) + '&appid=' + apikey + '&lang=ja');
        const forecastResponse = await fetch(forecastApiUrl + encodeURIComponent(city) + '&appid=' + apikey + '&lang=ja');

        if (response.status == 404 || forecastResponse.status == 404) {
          document.getElementById("error-message").textContent = "éƒ½å¸‚åãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“";
          document.getElementById("current-weather").style.display = "none";
          document.getElementById("hourly-forecast").style.display = "none";
          document.getElementById("sun-info").style.display = "none";
          document.getElementById("daily-forecast").style.display = "none";
          return;
        } else {
          document.getElementById("error-message").textContent = "";
          document.getElementById("current-weather").style.display = "";
          document.getElementById("hourly-forecast").style.display = "";
          document.getElementById("sun-info").style.display = "";
          document.getElementById("daily-forecast").style.display = "";
        }

        const data = await response.json();
        const forecastData = await forecastResponse.json();

        // Current weather
        document.getElementById("location-name").innerText = data.name;
        document.getElementById("temperature").innerText = Math.round(data.main.temp) + "Â°C";
        document.getElementById("humidity").innerText = data.main.humidity + "%";
        document.getElementById("wind").innerText = data.wind.speed + "km/h";
        document.getElementById("description").innerText = data.weather[0].description;
        document.getElementById("weather-time").innerText = new Date(data.dt * 1000).toLocaleTimeString("ja-JP");

        // Weather icon
        const iconMap = {
          "Clouds": "clouds.png",
          "Rain": "rain.png",
          "Clear": "clear.png",
          "Mist": "mist.png",
          "Drizzle": "drizzle.png",
          "Snow": "snow.png"
        };
        weatherImg.src = "images/" + (iconMap[data.weather[0].main] || "clouds.png");

        // Sun info
        document.getElementById("sunrise").textContent = new Date(data.sys.sunrise * 1000).toLocaleTimeString("ja-JP");
        document.getElementById("sunset").textContent = new Date(data.sys.sunset * 1000).toLocaleTimeString("ja-JP");
        const duration = (data.sys.sunset - data.sys.sunrise) / 3600;
        document.getElementById("day-length").textContent = `${Math.floor(duration)}æ™‚é–“${Math.round((duration % 1) * 60)}åˆ†`;

        // Hourly forecast (next 6)
        document.getElementById("hourly-forecast").innerHTML = forecastData.list.slice(0, 6).map(f => `
          <div class="hourly-card">
            <div>${new Date(f.dt * 1000).getHours()}:00</div>
            <img src="images/${iconMap[f.weather[0].main] || "clouds.png"}" class="hourly-icon" alt="">
            <div>${Math.round(f.main.temp)}Â°</div>
          </div>`).join('');

        // Daily forecast (group by day)
        const daily = {};
        forecastData.list.forEach(f => {
          const day = new Date(f.dt * 1000).toLocaleDateString("ja-JP", { weekday: 'short' });
          if (!daily[day]) daily[day] = [];
          daily[day].push(f);
        });
        document.getElementById("daily-forecast").innerHTML = Object.entries(daily).slice(0, 7).map(([day, list]) => {
          const temps = list.map(l => l.main.temp);
          const max = Math.round(Math.max(...temps));
          const min = Math.round(Math.min(...temps));
          const icon = iconMap[list[0].weather[0].main] || "clouds.png";
          return `<div class="daily-card">
            <div>${day}</div>
            <img src="images/${icon}" class="daily-icon" alt="">
            <div>${max}Â° / ${min}Â°</div>
          </div>`;
        }).join('');

        lastForecastData = forecastData;
        renderHourly(forecastData, currentHourlyType);

      } catch (e) {
        document.getElementById("error-message").textContent = "å¤©æ°—æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ";
      }
    }

    // Search button and Enter key
    searchBtn.addEventListener("click", () => {
      checkWeather(searchInput.value);
    });
    searchInput.addEventListener("keypress", (event) => {
      if (event.key === "Enter") {
        checkWeather(searchInput.value);
      }
    });

    // Mode toggle
    document.getElementById("toggle-mode").addEventListener("click", () => {
      const body = document.getElementById("body");
      if (body.classList.contains("dark-mode")) {
        body.classList.remove("dark-mode");
        body.classList.add("light-mode");
      } else if (body.classList.contains("light-mode")) {
        body.classList.remove("light-mode");
        body.classList.add("dark-mode");
      } else {
        body.classList.add("dark-mode");
      }
    });

    // Tab click event
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        currentHourlyType = this.getAttribute('data-type');
        if (lastForecastData) renderHourly(lastForecastData, currentHourlyType);
      });
    });

    // Xá»­ lÃ½ nÃºt Ä‘á»‹nh vá»‹
    document.getElementById("locate-btn").addEventListener("click", function() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apikey}&units=metric&lang=ja`)
            .then(res => res.json())
            .then(data => {
              checkWeather(data.name);
            });
        }, function() {
          alert("ä½ç½®æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ");
        });
      } else {
        alert("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ä½ç½®æƒ…å ±å–å¾—ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“");
      }
    });

    // Initial load
    checkWeather("Tokyo");
  </script>
</body>
</html>








